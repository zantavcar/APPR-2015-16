---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Žan Tavčar"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Analiziral bom prošnje za azil v letošnjem letu v državah EU ter številke primerjal z lanskimi. Zanime me sestava migrantov, kje jih je največ zaprosilo za azil ter kako se migrantska kriza lahko primerja z balkansko po letu 1990.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozili smo podatke o vloženih prošnjah za azil v državah EU v letih  2014 in 2015 v obliki CSV (vsako smo uvozili posebej) z Eurostata ter rezultate prošenj za azil v letu 2014 v obliki HTML, prav tako z Eurostata. Ker me je zanimala dinamika migracij v zadnjih dveh desetletjih, sem pod drobnogled vzel države, ki so bile v tem času najbolj aktivne v migarcijskem smislu. Podatke o migracijah sem pridobil na strani svetovne banke. Sledi še razpredelnica poglobljene analize, zanima me namreč sestava migrantov (predvsem starostna in spolna sestava), podatke za to razpredelnico sem črpal iz Eurostata.

```{r razpredelnice}
uvozi.Prosnje2015 <- function() {
Prosnje2015 <- read.table("prosnje_azil_2015.csv",sep=";",
               skip=8,nrows=32,
               na.strings=":",
               as.is=TRUE,
               row.names= NULL,
               fileEncoding="UTF-8")

#Precistil bom nepotreben stolpec s podatki iz leta 2014
Prosnje2015<-Prosnje2015[-2]
#Poimenoval bom stolpce in vrstice
colnames(Prosnje2015) <- c("Države",paste0("M",1:11))
rownames(Prosnje2015) <- Prosnje2015[,1]
Prosnje2015 <- Prosnje2015[-1]

#Logični vektorji za vsa tri četrtletja - regularni izrazi

prvo.cetrtletje <- grepl("^M[1-3]",colnames(Prosnje2015))
drugo.cetrtletje <- grepl("^M[4-6]",colnames(Prosnje2015))
tretje.cetrtletje <- grepl("^M[7-9]",colnames(Prosnje2015))

Na konec bom dodal tri stolpce, in sicer za vsako  četrtletje
#število prošenj za azil za vsako državo, to bo pomembno v 
#nadaljevanju, ko bom primerjal z istimi obdobji lani
Q1 <- apply(Prosnje2015[,prvo.cetrtletje],1, 
            function (x) sum(x,na.rm=TRUE))
Q2 <- apply(Prosnje2015[,drugo.cetrtletje],1, 
                  function (x) sum(x,na.rm=TRUE))
Q3 <- apply(Prosnje2015[,tretje.cetrtletje],1, 
                  function (x) sum(x,na.rm=TRUE))
Prosnje2015$Q1 <- Q1
Prosnje2015$Q2 <- Q2
Prosnje2015$Q3 <- Q3


return(Prosnje2015)
}
```

Zgoraj je 
Slika \ref{fig:histogram} prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
hist(obcine[,4], main = "Pogostost števila naselij",
     xlab = "Število naselij", ylab = "Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Slika \ref{fig:zemljevid} prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
n <- 100
barve <- topo.colors(n)[1+(n-1)*(druzine$povprecje-min.povprecje)/(max.povprecje-min.povprecje)]
plot(zemljevid, col = barve)
title("Povprečno število otrok v družini")
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Slika \ref{fig:graf} prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
plot(obcine[[1]], obcine[[4]],
     main = "Število naselij glede na površino občine",
     xlab = expression("Površina (km"^2 * ")"),
     ylab = "Št. naselij",
     col = barve[obcine[[7]]],
     pch = 18)
legend("topright", legend = names(barve), col = barve,
       pch = 18, cex = 0.5, bg = "white")
```

***